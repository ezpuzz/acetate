<form id="search" action="/releases" method="get" hx-boost="true" hx-push-url="true"
    class="px-4 flex-none flex flex-wrap items-stretch gap-2">


    <div class="flex flex-col items-start">
        <label for="label">Label</label>

        <input id="label" hx-trigger="input changed delay:500ms, search" hx-get="/releases" hx-target="#results"
            hx-include="#search, #filters, #pagination" type="search" name="label" value="{{label|d()}}"
            placeholder="Defected" class="rounded-md border p-2 w-1/5 min-w-64" />
    </div>


    <div class="flex flex-col items-start">
        <label for="song">Song Name</label>

        <input id="song" hx-trigger="input changed delay:500ms, search" hx-get="/releases" hx-target="#results"
            hx-include="#search, #filters, #pagination" type="search" name="song" value="{{song|d()}}"
            placeholder="Don't Cry Tonight" class="rounded-md border p-2 w-1/5 min-w-64" />
    </div>

    <div class="flex flex-col items-start">
        <label for="artist">Artist</label>

        <input id="artist" hx-trigger="input changed delay:500ms, search" hx-get="/releases" hx-target="#results"
            hx-include="#search, #filters, #pagination" type="search" name="artist" value="{{artist|d()}}"
            placeholder="Acen" class="rounded-md border p-2 w-1/5 min-w-64" />
    </div>


    <div class="flex items-center gap-2">
        <label for="videos_only">Only Release with Videos</label>
        <input type="checkbox" id="videos_only" name="videos_only" checked hx-trigger="click" hx-get="/releases"
            hx-target="#results" hx-include="#search, #filters, #pagination" />
        <input type="hidden" name="videos_only" value="off" />
    </div>
</form>

<div class="flex grow min-h-0">
    <div id="filters" class="w-24 sm:w-48 shrink-0 h-full flex flex-col">
        <h2 class="text-xl px-2 bg-slate-100">Filters</h2>
        <div class="overflow-auto grow px-2">
            {% for f in filters["aggregations"] %}
            <h3 class="text-lg">{{f}}</h3>
            {% for v in filters["aggregations"][f]["buckets"] %}
            <label class="border p-1 sm:p-px rounded-lg sm:border-none has-[:checked]:bg-blue-400 flex
                mb-1 sm:mb-0 items-center leading-tight hyphens-auto break-normal text-ellipsis overflow-hidden"><input
                    class="peer hidden sm:block mr-1" hx-get="/releases" hx-target="#results"
                    hx-include="#search, #filters, #pagination" type="checkbox"
                    name="{{filters['aggregations'][f]['meta']['field']}}" value='{{v["key"]}}' hx-push-url="true" {% if
                    filters['aggregations'][f]['meta']['field'] in request.args and
                    request.args[filters['aggregations'][f]['meta']['field']]==v["key"] %}checked{% endif %} />
                {{v["key"]}}
            </label>
            {% endfor %}
            {% endfor %}
        </div>
    </div>

    <div id="results" class="grow flex flex-col min-w-0" id="releases">

        {% include 'releases/results.jinja' %}

    </div>
</div>